[TOC]

# Linux基础知识

Linux内核和开发版的区别：在内核的基础上加入了桌面环境和各种软件，就成了开发版

Linux主要发行版本：

*   CentOS（RedHat）
*   Ubuntu（debian）

两种类别的包安装方式不太一样，CentOS在各大公司使用较多适用于服务器，而ubuntu主要是桌面端，桌面会比较漂亮，适合个人使用

## 虚拟机快照

保存虚拟机状态，有利于后续系统出现问题时进行回溯

快照还可以克隆，有利于打开多台计算机进行开发

善于利用虚拟机的快照功能

## 系统分区

**主分区**：最多四个

**扩展分区**：最多一个，将一个主分区改为扩展分区，扩展分区可以再分为逻辑分区。扩展分区只可以再分为逻辑分区，不能存储数据

**逻辑分区**：属于扩展分区，可以存储数据，等同于一个主分区

**格式化**：写入文件系统，将硬盘的一个区域（比如一个分区），按照特定规则进行初始化，比如进行数据分块，创建文件头等

## 配置网络

在虚拟机的host-only或者NAT模式下，我们可以首先确定ip，在VMware的虚拟网络编辑器中查看相应网段，以及win10系统控制面板中确定物理机相关IP，而后配置虚拟机的IP。

```shell
ifconfig eth0 xxx.xxx.xxx.xxx
```

`eth0`表示了网卡的名字，其后为IP地址

这种更改方式是一次性的，重启虚拟机则失效了

写入相应配置文件可以保证永久有效

## Linux目录作用

|    目录     |                             作用                             |
| :---------: | :----------------------------------------------------------: |
|    /bin     |             存放系统命令，普通用户和root均可执行             |
|    /sbin    |                存放系统命令，只有root可以执行                |
|  /usr/bin   |  类似于/bin，但单用户模式不可执行，存放的命令与系统启动无关  |
|  /usr/sbin  |              类似于/sbin，但单用户模式不可执行               |
|    /boot    |    系统启动目录，包含系统启动相关文件，内核和启动引导程序    |
|    /dev     |                    硬件设备文件保存的位置                    |
|    /etc     | 配置文件保存的位置，系统默认安装的软件（centos下的rpm安装）其配置文件均在此，包括了用户的账户密码等 |
|    /home    |                      用户的默认登录位置                      |
|    /lib     |                       系统调用的库函数                       |
| /lost+found | 保存系统崩溃、意外关机时产生的一些文件碎片，修复已经损坏的文件系统，是备份恢复目录 |
|   /media    |                  挂载媒体设备，如软盘、光盘                  |
|    /mnt     |               挂载U盘、移动硬盘或其他操作系统                |
|    /misc    |                    挂载NFS服务的共享目录                     |
|    /opt     | 第三方软件的保存位置，放置和安装其他软件。但一般使用`/usr/local`来作为软件的安装保存目录 |
|    /proc    | 虚拟文件系统，保存在内存中，主要用于保存系统的内核、进程和外部设备状态 |
|    /sys     |       虚拟文件系统，保存在内存中，用于保存内核相关信息       |
|    /root    |                        管理员的家目录                        |
|    /srv     |                         服务数据目录                         |
|    /tmp     |            临时目录，存放临时的文件，无法保存数据            |
|    /usr     |  系统资源目录，`Unix Software Resource`安装的软件大多在这里  |
|    /var     |  动态数据保存位置，主要保存缓存、日志以及软件运行产生的文件  |



## 常用命令

命令结构：命令  [-选项]  [参数]



### 目录操作

`ls -l（long）`可以查看文件的详细信息，但有关文件大小。人类很难看懂，可以再加参数`h（human）`查看文件大小

---

`cp -rp 源目录 目标目录`拷贝目录到指定目录的*下面*，`-r`表示拷贝的是目录，`-p`表示复制属性（包括修改日期等）。也可以同时拷贝多个文件或目录，只需要保证最后一个参数是目标目录即可。当目标目录下不存在相关名称的目录时，会自动创建并拷贝

---

`rm -rf 文件或目录`删除指定目录或文件，`-r`删除目录，`-f`强制执行（force）

---

`mkdir -p 目录`可以递归创建目录和子目录



### 文件操作

`cat -n 文件`显示文件内容，`-n`表示显示行号。`tac`类似于`cat`，倒着显示文件内容

------------

`more 文件`显示文件部分内容。`空格`或`f`翻页，`回车`会下移一行，`q`会退出

-----------

`less 文件`同样是查看文件的命令，只不过可以通过上下箭头进行换行查看，同时可以类似`vim`编辑器，使用`/ + 关键词`搜索相关内容

----------

`head -n 行数 文件`查看文件的前面多少行，不加参数`-n`时，会默认查看10行。与此对应的，可以用`tail`查看文件的最后几行，与此同时，`tail`命令还可以使用选项`-f`，它会动态显示文件的最后几行内容，当文件出现改动时，动态打印出来

---------------------------

`ln -s 源文件 目标文件`，生成软链接，如果去掉`-s`选项，则生成的是硬链接。软链接类似于快捷方式，指向源文件；硬链接则有点像是拷贝，只不过硬链接可以保证和源文件的同步更新。

>   硬链接像是新创建了一个inode指向文件数据块，所以使用rm删除源文件时，可以通过硬链接重新访问到源文件。软链接则像是保存了一个绝对路径，每次访问软链接时自动替换，变成访问这个绝对路径。
>
>   一般硬链接使用较少，软链接使用较多。
>
>   硬链接无法跨越分区，且只能对文件而不能对目录进行硬链接。这两点软链接都是可以的。



### 权限操作

`chmod [ugoa][+-=][rwx] 文件/目录`更改文件的权限，`ugoa`分别表示用户，所属组、其他人的权限，`+-=`分别表示增加权限、减少权限、直接赋予权限（不管之前权限是啥），`rwx`分别表示读、写、执行权限。比如：`chmod u+x,o-r 文件`，给用户增加执行权限、给其他人去掉读权限。

还可以使用数字来调整权限，`r-4 w-2 x-1`，可以用二进制去记，即`111表示7，即拥有rwx权限`。`chmod 777 文件`，表示赋予u、g、o用户以文件的全部权限。

`chmod -R 740 目录`，表示递归对目录下的全部目录和文件都赋予权限`rwxr-----`。

| 权限 |    对于文件    |            对于目录             |
| :--: | :------------: | :-----------------------------: |
|  r   | 查看文件的内容 | 查看该目录下的文件与目录信息-ls |
|  w   | 修改文件的内容 |   删除或创建该目录下的文件-rm   |
|  x   |    执行文件    |          进入该目录-cd          |

-------------------------

`chown 用户 文件或目录`更改文件的所有者。`chown lyg money`，文件`money`的所有者变为`lyg`。

`chgrp 用户组 文件或目录`更改文件的所属组。

---

`groupadd 所属组名`，添加相关用户组

`useradd 用户名`，添加用户

---

`umask -S`，查看创建文件时的缺省权限（默认权限）

```shell
$ umask -S
u=rwx,g=rx,o=rx
$ umask
0022	# 0表示特殊权限，022表示----w--w-，该权限通过和rwxrwxrwx进行与运算，得到缺省权限
$ umask 077	# 修改缺省权限
```

缺省创建的目录，权限为`rwxr-xr-x`；缺省创建的文件，权限为`rw-r--r--`，即默认文件不具有执行权限。

>   这一点是基于安全考虑，避免病毒程序具有执行权限



### 查找操作

`find [搜索范围] [匹配条件]`，搜索相关的文件。

匹配条件包括：

1.  `-name 文件名`根据文件名搜索，但这样搜索不是模糊的，文件名必须是这个才能被搜到。使用`*文件名*`，可以进行模糊搜索；使用`文件名???`，搜索到文件名后只有三个字符的文件。（？表示模糊单个字符，*表示模糊多个字符）该种搜索区分大小写

    ```shell
    $ find / -name init
    # 唯一文件名
    init
    
    $ find / -name *init*
    # 前后模糊
    ainit
    binit
    initc
    abinitc
    initabc
    
    $ find / -name init???
    # init后接3个字符
    initabc
    ```

2.  `-iname 文件名`不区分大小写的搜索，其他与`-name`类似

3.  `-size [+-=]文件大小`按照文件大小搜索，搜索大于（或小于或等于）多少KB的文件，这里的大小按照数据块换算，一个数据块是512B，100MB=204800，`find / -size +204800`，搜索所有大于100MB的文件

4.  `-user 用户名`查找所有属于该用户的文件

5.  `-cmin -2`（change）查找2分钟内，被修改过属性（所有者、权限等）的文件。同时还有参数`-amin`（access）——2分钟内被访问过的文件；`-mmin`（modify）——2分钟内被修改过（内容）的文件

6.  `-a -o`，表示同时满足两个条件（and）或满足一个条件即可（or）的文件

    ```shell
    # 查找大于102400或者小于100大小的文件
    find / -size +102400 -o -size -100
    
    ```

7.  `-type [fdl]` 根据文件类型查找，分别表示文件、目录、软链接

8.  对查找结果执行操作

    ```shell
    find /etc -name init -exec/-ok ls -l {} \;
    ```

    查找`init`文件；`-exec`或`-ok`连接前后；`ls -l`打印查找到的文件详细信息；`{} \;`是固定格式，`{}`表示前面的查找结果，`\`表示转义符，`;`表示结束符。

    使用`ok`时会在对查找到的每个文件进行处理时询问，`exec`默认不询问直接操作。

9.  `-inum 12345`使用`inode-id`进行查找

---

`locate 文件名`，查找相关文件。与`find`命令相比，速度更快。

该命令也区分大小写，`-i`可不区分大小写

>   locate维护了一个资料库，类似于缓存，因此查找速度快；但新建文件可能无法搜索到，因为资料库更新不及时
>
>   find则是直接在硬盘上进行查找，所以较慢且即为耗费资源

`updatedb`，更新资料库，便于查找新建文件

>   某些目录，比如`/tmp`，其中的文件不会收录在资料库里，因此永远无法查找到

---

`which 命令`，查找命令的二进制文件所在的位置

`whereis 命令`，查找命令所在位置，以及帮助文档所在位置

---

`grep -iv 字符串 文件`，查找该文件中有无相关字符。`-i`表示不区分大小写，`-v`表示查找不包含指定字符的行，`grep -v ^# file-name`，表示查找不以`#`开头的行



### 帮助命令

`man`表示`manual`的意思，如`man ls`会列举出`ls`的帮助信息

一般`man1`表示命令的帮助，`man5`表示配置文件的帮助；使用`man`时会优先显示命令的帮助，`man 5 命令`会显示该命令的配置文件的帮助

---

`whatis 命令`简单解释该命令是干嘛的

`apropos 配置文件名`解释该配置文件的用处

`命令 --help`列举出该命令有哪些选项

`help 命令`查看`Shell`内置命令的帮助



### 用户管理

`useradd 用户名`在系统中添加用户

`passwd 用户名`root用户给普通用户设置密码，直接`passwd`可以使普通用户给自己更改密码

`who`查看当前已经登录的用户，在其中显示的`tty`表示本地终端、`pts`表示远程登录

`w`查看比`who`更详细的登录用户信息



### 压缩解压

```shell
# 只能压缩文件，不保留原文件
# 想压缩目录，先用tar打包目录，再压缩
gzip xx	# 生成xx.gz压缩包
gunzip xx.gz	# 解压
gzip -d xx.gz	# 解压

# tar-打包
###### 打包时 #########
# -c 打包（create）
# -v 显示打包时的详细信息
# -f 指定文件名（file）
# -z打包的同时压缩（zip）（适用于gz） | -j 压缩（适用于bz2）
##### 解包时 #########
# -x 解包
# -v 显示详细信息
# -f 指定解压文件
# -z 解压缩（适用于gz） | -j 解压缩（适用于bz2）
tar -cvf xx.tar xx	#将xx打包为xx.tar
tar -zcvf xx.tar.gz xx	#将xx打包并压缩为xx.tar.gz
tar -zxvf xx.tar.gz

# zip
# 可保留源文件
# 使用-r选项可以压缩目录
zip -r xx.zip xx	# 将xx压缩为xx.zip
unzip xx.zip	# 解压缩xx.zip

# bzip2——gzip的升级版本
# -k 压缩时保留源文件
bzip2 -k xx	# 将xx压缩为xx.bz2
bunzip2 -k xx.bz2	# 解压缩并保留压缩包 
tar -jxvf xx xx.tar.gz2	# 将xx.tar.gz2解压为xx
```



 ### 网络命令

`write 用户名`给对应用户发送消息，`ctrl+d`进行保存发送，发送时用户必须在线才能接受到

`wall message`给当前在学的所有用户发送信息

`mail 用户名`给用户发送电子邮件，用户可以不在线。`ctrl +d`保存发送。使用`mail`可以进入邮件系统接受邮件，具体操作可键入`help`查看使用帮助

`last`统计服务器的所有登录过的用户信息以及重启信息（可包含一个用户的多次登录信息）

`lastlog`列出所有的用户，并列出每个用户的最后一次登录时间（每个用户只包含最后一次登录信息）

`ping -c 4 xxx.xxx.xxx.xxx`测试网络的连通性，`-c`表示发送包的个数

`ifconfig 网卡名 IP地址`给对应网卡配置IP，`ifconfig`可以查看当前网卡信息

`traceroute`显示数据包从主机到指定网址的路径

`netstat`查询网络状态，`-t`TCP协议，`-u`UDP协议，`-l`监听，`-r`路由，`-n`显示IP和端口号。

```shell
netstat -tlun 	# 查看监听端口
netstat -an		# 查看所有端口，包括监听的和已连接的
netstat -rn		# 查看路由表
```

`setup`是只有`redhat`版本的Linux才具备的命令，使用图形界面去配置IP地址以及网关和DNS等

`service network restart`重启网络服务

`mount -t 文件系统 设备名 挂载点`，挂载U盘光盘等设备，比如`mount -t iso9660 /dev/sr0 /mnt/cdrom`

但其实可不写文件系统，系统可自动识别，即`mount /dev/sr0 /mnt/cdrom`

此时进入`/mnt/cdrom`即可查看光盘中的文件

`umount /dev/sr0`或`umount /mnt/cdrom`，卸载



### 重启关机命令

```shell
shutdown -h now	# 即刻关机
shutdown -c 	# 取消上一次的关机命令
shutdown -r now	# 重启

# 其他关机命令
halt
poweroff
init 0

# 其他重启命令
reboot
init 6

logout	# 当前用户退出登录
```



## CentOS软件包管理

软件包

*   源码包——只给源码，自己编译（一般有安装脚本），开源，卸载方便；由于是自己编译安装，所有更适合自己的系统
*   二进制包——编译好的包，安装速度更快

### RPM包基础知识

#### 命名规则

以`httpd-2.2.15-15.el6.centos.1.i686.rpm`为例

```
httpd				软件包名
2.2.15				软件版本
15					发布次数
el6.centos			适合的Linux平台（el6和centos）
i686(/noarch)		适合的硬件平台(/任何平台均适合)
rpm					包扩展名
```

#### 依赖性

*   树形依赖：a-b-c
*   环形依赖：a-b-c-a

#### RPM相关命令

##### rpm包安装

`rpm -ivh 包全名`，其中`-i`表示安装，`-v`显示安装时的信息，`-h`显示安装进度，`--nodeps`表示不检测依赖性

`rpm -Uvh 包全名`，`-U`表示升级`upgrade`

`rpm -e 包名`，卸载相关包，`--nodeps`表示不检测依赖性

这种安装方式，必须保证命令执行时填写的包的位置路径是正确的

##### rpm包查询

`rpm -q 包名`，查询相关软件包是否安装（query）

`rpm -qa`，查询所有的安装包（all）

`rpm -qi 包名`，查询软件包的详细信息（info）

`rpm -qip 包名`，查询未安装的软件包的详细信息

`rpm -ql 包名`，查询包中的文件安装位置（list）

`rpm -qlp 包全名`，查询软件包如果安装，它的文件安装位置

`rpm -qf 系统文件名`，查询系统文件属于哪个包

`rpm -qRp 包名`，查询未安装的软件包的依赖性（requires）

##### rpm包校验

`rpm -V 包名`，校验安装包

校验正确，则什么都不打印

校验错误会打印验证信息，如`S.5....T c /etc/xxx`表示xxx文件发生了改变，改变的信息有`S、5、T`

```
验证信息
S	文件大小改变
M	文件权限改变
5	MD5校验改变，文件内容改变
D	设备改变
L	文件路径改变
U	文件所有者改变
G	文件所属组是否改变
T	文件修改时间改变

文件类型
c	配置文件（config file）
d	普通文档（document）
g	鬼文件，指原包不含这个文件该情况较少见（ghost file）
l	授权文件（license file）
r	描述文件（read me）
```

##### rpm包文件提取

`rpm2cpio 包全名 | cpio -idv .文件绝对路径`，将rpm包转化为cpio格式，然后从中提取对应文件到其对应路径（即，命令中的文件绝对路径）

>   cpio是一个标准工具，用于创建软件档案文件和从档案文件中提取文件

`cpio `的选项包括：`-i`还原文件，`-d`还原时自动新建目录，`-v`显示还原过程

用法：`cpio 选项 < 设备或文件`



### yum在线管理

#### yum源配置

打开`/etcyum.repos.d/CentOS-Base.repo`

```
yum源说明
[base]		#容器名称，软件池名称
name		#容器说明，解释一下
mirrorlist	#镜像网站
baseurl		#yum源服务器地址
enabled		#此容器是否生效
gpgcheck	#1-RPM数字验证生效，0-不生效
gpgkey		#数字证书的公钥保存位置
```

#### yum命令

```shell
yum list		  	# 查询yun可安装软件包
yum search key-word	# 搜索相关软件包
yum -y install package-name	# 安装软件包，不询问安装
yum -y update package-name	# 升级软件包，不写包名会升级所有软件包，包括内核
yum -y remove package-name	# 卸载安装包

yum grouplist	# 列举出所有可用的软件组
yum groupinstall group-name	# 安装软件组
yum groupremove	group-name	# 卸载软件组
```

#### 光盘yum源

挂载光盘

令网络yum源失效（可直接删除那几个配置文件，记得备份）

设置光盘yum源

### 源码包与RPM包的区别

```
RPM包安装位置汇总
/etc/				# 配置文件安装目录
/usr/bin			# 可执行命令安装目录
/usr/lib			# 函数库安装位置
/usr/share/doc/		# 软件使用手册安装位置
/usr/share/man		# 帮助文件安装位置
```

源码包会手动指定位置，一般安装在`/usr/local/软件名`下

---

RPM包的服务可以通过系统服务来管理

源码包的服务由于不在默认路径中，因此只能用绝对路径启动

---

源码包卸载时，直接删除安装目录就可以，不需要其他操作







# Linux中的问题解决

## VirtualBox菜单栏被隐藏了

在window系统中，可使用`右ctrl + c`调出菜单栏。

## 添加用户

使用命令：

```shell
sudo adduser user-name
```

注意可能需要root权限才可以添加。

## 为用户添加root权限

在使用时，新建一个用户，但在执行`sudo`相关命令时提示：

```
git is not in the sudoers file.  This incident will be reported.
```

这是由于未给相关用户添加权限。

解决方法：

1.  先切换到root用户

    ```shell
    su -
    # 输入root的密码
    ```

2.  给`sudoers`文件添加写权限

    ```shell
    chmod u+x /etc/sudoers
    ```

3.  在`sudoers`文件中给用户添加root权限

    打开`sudoers`文件，然后找到对应位置：

    ![image-20200711130247097](linux.assets/image-20200711130247097.png)

    如图只有root和lyg用户拥有root权限。

    为自己需要用户添加权限可仿照上图的书写方式。

4.  撤销`sudoers`的写权限

    ```shell
    chmod u-x /etc/sudoers
    ```



## CentOS8 安装后无法上网

1.  编辑文件`/etc/sysconfig/network-scripts/ifcfg-ens33`
2.  修改`ONBOOT=no`为`yes`（此处操作表示将网卡启动）
3.  重新加载网卡，`nmcil c reload`







## asd

# Shell命令大全

| 命令 |       功能描述       |
| :--: | :------------------: |
| cal  |    显示本月的日历    |
|  cd  |       修改目录       |
| date |    显示日期和时间    |
|  df  |   查看磁盘剩余容量   |
| exit |       退出终端       |
| free |   查看内存剩余空间   |
|      |                      |
| pwd  | 打印当前文件目录路径 |



# Vim使用

## 模式

命令模式：刚打开文件时候，等待执行命令，无法编辑文本

插入模式：在命令模式，输入`i、a、o`进入，即输入文本

编辑模式：在最低下输入各种指令，输入`：`进入编辑模式

### 插入模式

```shell
a	在光标字符后插入
A	在光标所在行尾插入
i	在光标字符前插入
I	在光标所在行首插入
o	在光标下插入新行
O	在光标上插入新行
```

### 编辑模式

```shell
:set nu		# 设置行号
:set nonu	# 取消行号
:set ic		# 忽略搜索大小写
gg			# 到第一行
G			# 到最后一行
nG			# 到第n行
:n			# 到第n行
$			# 移动至行首
0			# 移动至行尾
------------
x			# 删除光标所在字符
nx			# 删除光标所在后n个字符
dd			# 删除光标所在行
ndd			# 删除从光标往下的n行
dG			# 删除从光标到文件末尾的内容
D			# 删除从光标到行尾的内容
:n1,n2d		# 删除从第n1行到第n2行
------------
yy			# 复制当前行
nyy			# 复制当前往下n行
dd			# 剪切当前行
ndd			# 剪切当前往下n行
p			# 粘贴到光标所在行上
P			# 粘贴到光标所在行下
------------
r			# 替换光标所在处字符
R			# 从光标所在处开始替换，ESC结束
u			# 取消上一步操作
------------
/string		# 搜索关键词string
n			# 搜索时跳转下一个
:%s/old/new/g	# %s表示全文，old是原内容，new是替换掉的新内容
:1,5s/old/new/c # 对1-5行进行替换,且替换时询问
------------
:w				# 保存
:w file-path	# 另存为
:wq				# 保存退出
ZZ				# 保存退出
:q!				# 不保存退出
:wq!			# 对只读文件进行强行保存并退出
```

## 使用技巧

```shell
# 导入文本
:r file-path	# 将指定路径的文件内容导入当前文件的光标处
:![command]		# 将vim当成shell使用，执行相关命令
:r !date		# 将date命令的执行结果导入
# 快捷键
:map ^P I#<ESC>	# ^P是按ctrl+v+p得到的，该命令设置了快捷键，即当按ctrl+p时，输入I#<ESC>（再行首添加字符#，再ESC退出插入模式）
:map ^B 0x		# ctrl+b，会将行首的第一个字符删除，且停留在插入模式
# 注释
:1,4s/^/#/g		# ^表示行首插入，在第一到第4行添加注释符#
:1,4s/^#//g		# 去掉第一行到第四行开头的#
:1,4s/#//g		# 去掉第一行到第四行的所有#，包括行内的
# 替换
:ab name liang	# 将name替换为liang，每次输入时会自动替换
```

`.vimrc`放置一些编辑模式的命令，比如`set nu`设置行号，或是定义一些快捷键。

该文件存放在用户的家目录下
------WebKitFormBoundaryZHRSS3nJyvvxtZOG--
